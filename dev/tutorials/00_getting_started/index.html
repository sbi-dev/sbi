
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://sbi-dev.github.io/sbi/dev/tutorials/00_getting_started/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Getting started with sbi - sbi</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.75 1.75 0 0 1 1 7.775m1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../static/global.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-started-with-sbi" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="sbi" class="md-header__button md-logo" aria-label="sbi" data-md-component="logo">
      
  <img src="../../static/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            sbi
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Getting started with sbi
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="http://github.com/sbi-dev/sbi" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    sbi-dev/sbi
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="sbi" class="md-nav__button md-logo" aria-label="sbi" data-md-component="logo">
      
  <img src="../../static/logo.svg" alt="logo">

    </a>
    sbi
  </label>
  
    <div class="md-nav__source">
      <a href="http://github.com/sbi-dev/sbi" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    sbi-dev/sbi
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials and Examples
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to contribute
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code_of_conduct/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code of Conduct
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../citation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Citation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../credits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Credits
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#parameter-inference-in-a-linear-gaussian-example" class="md-nav__link">
    <span class="md-ellipsis">
      Parameter inference in a linear Gaussian example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualisations-of-the-inferred-posterior-for-a-new-observation" class="md-nav__link">
    <span class="md-ellipsis">
      Visualisations of the inferred posterior for a new observation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assessing-the-posterior-for-the-known-theta-x-pair" class="md-nav__link">
    <span class="md-ellipsis">
      Assessing the posterior for the known (\(\theta, x\)) - pair
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assessing-the-predictive-performance-of-the-posterior" class="md-nav__link">
    <span class="md-ellipsis">
      Assessing the predictive performance of the posterior
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="getting-started-with-sbi">Getting started with <code>sbi</code><a class="headerlink" href="#getting-started-with-sbi" title="Permanent link">&para;</a></h1>
<p>Note, you can find the original version of this notebook at <a href="https://github.com/sbi-dev/sbi/blob/main/tutorials/00_getting_started.ipynb">/tutorials/00_getting_started.ipynb</a> in the <code>sbi</code> repository.</p>
<p><code>sbi</code> provides a simple interface to run state-of-the-art algorithms for simulation-based inference.</p>
<p><strong>The overall goal of simulation-based inference is to algorithmically identify model parameters which are consistent with data.</strong></p>
<p>In this tutorial we demonstrate how to get started with the <code>sbi</code> toolbox and how to perform parameter inference on a simple model.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">from</span> <span class="nn">sbi.analysis</span> <span class="kn">import</span> <span class="n">pairplot</span>
<span class="kn">from</span> <span class="nn">sbi.inference</span> <span class="kn">import</span> <span class="n">NPE</span>
<span class="kn">from</span> <span class="nn">sbi.utils</span> <span class="kn">import</span> <span class="n">BoxUniform</span>
<span class="kn">from</span> <span class="nn">sbi.utils.user_input_checks</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">check_sbi_inputs</span><span class="p">,</span>
    <span class="n">process_prior</span><span class="p">,</span>
    <span class="n">process_simulator</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="parameter-inference-in-a-linear-gaussian-example">Parameter inference in a linear Gaussian example<a class="headerlink" href="#parameter-inference-in-a-linear-gaussian-example" title="Permanent link">&para;</a></h2>
<p>Each of the implemented inference methods takes three inputs:<br />
1. observational data (or summary statistics thereof) - <em>the observations</em><br />
2. a candidate (mechanistic) model - <em>the simulator</em><br />
3. prior knowledge or constraints on model parameters - <em>the prior</em></p>
<p>If you are new to simulation-based inference, please first read the information on the <a href="https://sbi-dev.github.io/sbi/">homepage of the website</a> to familiarise with the motivation and relevant terms.</p>
<p>For this illustrative example we consider a model <em>simulator</em> that takes in 3 parameters (<span class="arithmatex">\(\theta\)</span>). For simplicity, the <em>simulator</em> outputs simulations of the same dimensionality and adds 1.0 and some Gaussian noise to the parameter set. </p>
<blockquote>
<p>Note: This is where you instead would use your specific  <em>simulator</em> with its parameters.</p>
</blockquote>
<p>For the 3-dimensional parameter space we consider a uniform <em>prior</em> between [-2,2].</p>
<blockquote>
<p>Note: This is where you would incorporate prior knowlegde about the parameters you want to infer, e.g., ranges known from literature. </p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">num_dim</span> <span class="o">=</span> <span class="mi">3</span>

<span class="k">def</span> <span class="nf">simulator</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="c1"># linear gaussian</span>
    <span class="k">return</span> <span class="n">theta</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>

<span class="n">prior</span> <span class="o">=</span> <span class="n">BoxUniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_dim</span><span class="p">),</span> <span class="n">high</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_dim</span><span class="p">))</span>
</code></pre></div>
<p>Here, we are using this simple toy simulator. In practice, the simulator can be anything
that takes parameters and returns simulated data. The data simulation process is
decoupled from the algorithms implemented in the <code>sbi</code> package. That is, you can
simulate your data beforehand, e.g., on a cluster or using a different programming
language or environment. All that <code>sbi</code> needs is a <code>Tensor</code> of parameters <code>theta</code> and
corresponding simulated data <code>x</code>. And, of course, observed data <code>x_o</code>. </p>
<p>However, <code>sbi</code> also offers a function to run your simulations in parallel. To that end,
we have to ensure that your <em>simulator</em> and <em>prior</em> adhere to the requirements of <code>sbi</code>
such as returning <code>torch.Tensor</code>s in a standardised shape. </p>
<p>You can do so with the <code>process_simulator()</code> and <code>process_prior()</code> functions, which
prepare them appropriately. Finally, you can call <code>check_sbi_input()</code> to make sure they
are consistent which each other.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check prior, return PyTorch prior.</span>
<span class="n">prior</span><span class="p">,</span> <span class="n">num_parameters</span><span class="p">,</span> <span class="n">prior_returns_numpy</span> <span class="o">=</span> <span class="n">process_prior</span><span class="p">(</span><span class="n">prior</span><span class="p">)</span>

<span class="c1"># Check simulator, returns PyTorch simulator able to simulate batches.</span>
<span class="n">simulator</span> <span class="o">=</span> <span class="n">process_simulator</span><span class="p">(</span><span class="n">simulator</span><span class="p">,</span> <span class="n">prior</span><span class="p">,</span> <span class="n">prior_returns_numpy</span><span class="p">)</span>

<span class="c1"># Consistency check after making ready for sbi.</span>
<span class="n">check_sbi_inputs</span><span class="p">(</span><span class="n">simulator</span><span class="p">,</span> <span class="n">prior</span><span class="p">)</span>
</code></pre></div>
<p>Next, we instantiate the inference object. In this example, we will use neural perform posterior estimation (NPE):</p>
<blockquote>
<p>Note: In <code>sbi</code> version 0.23.0, we renamed all inference classes from, e.g., <code>SNPE</code>, to <code>NPE</code> (i.e., we removed the <code>S</code> prefix). The functionality of the classes remains the same. The <code>NPE</code> class handles both the amortized (as shown in this tutorial) and sequential (as shown <a href="https://sbi-dev.github.io/sbi/tutorial/02_multiround_inference/">here</a>) versions of neural posterior estimation. An alias for <code>SNPE</code> still exists for backwards compatibility.</p>
<p>Note: This is where you could specify an alternative inference object such as NRE for ratio estimation or NLE for likelihood estimation. Here, you can see <a href="https://sbi-dev.github.io/sbi/latest/tutorials/16_implemented_methods/">all implemented methods</a>.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">inference</span> <span class="o">=</span> <span class="n">NPE</span><span class="p">(</span><span class="n">prior</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>
</code></pre></div>
<p>Next, we need simulations, or more specifically, pairs of parameters <span class="arithmatex">\(\theta\)</span> which we sample from the <em>prior</em> and corresponding simulations <span class="arithmatex">\(x = \mathrm{simulator} (\theta)\)</span>. The <code>sbi</code> helper function called <code>simulate_for_sbi</code> allows to parallelize your code with <code>joblib</code>.</p>
<blockquote>
<p>Note: If you already have your own parameters, simulation pairs which were generated elsewhere (e.g., on a compute cluster), you would add them here.  </p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">num_simulations</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">sample</span><span class="p">((</span><span class="n">num_simulations</span><span class="p">,))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">simulator</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;theta.shape&quot;</span><span class="p">,</span> <span class="n">theta</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x.shape&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>theta.shape torch.Size([2000, 3])
x.shape torch.Size([2000, 3])
</code></pre></div>

<p>We then pass the simulated data to the inference object. Both <code>theta</code> and <code>x</code> should be a <code>torch.Tensor</code> of type <code>float32</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">inference</span> <span class="o">=</span> <span class="n">inference</span><span class="o">.</span><span class="n">append_simulations</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div>
<p>Next, we train the <em>neural density estimator</em> to learn the association between the simulated data (or data features) and the underlying parameters:</p>
<div class="highlight"><pre><span></span><code><span class="n">density_estimator</span> <span class="o">=</span> <span class="n">inference</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code> Neural network successfully converged after 255 epochs.
</code></pre></div>

<p>Finally, we use this <em>density estimator</em> to build the posterior distribution <span class="arithmatex">\(p(\theta|x)\)</span>, i.e., the distributions over paramters <span class="arithmatex">\(\theta\)</span> given observation <span class="arithmatex">\(x\)</span>. </p>
<p>The <code>posterior</code> can then be used to (among other features which go beyond the scope of this introductory tutorial) sample parameters <span class="arithmatex">\(\theta\)</span> from the posterior via <code>.sample()</code>, i.e., parameters that are likely given the observation <span class="arithmatex">\(x\)</span>. </p>
<p>We can also get log-probabilities under the posterior via <code>.log_prob()</code>, i.e., we can evaluate the likelihood of parameters <span class="arithmatex">\(\theta\)</span> given the observation <span class="arithmatex">\(x\)</span>. </p>
<div class="highlight"><pre><span></span><code><span class="n">posterior</span> <span class="o">=</span> <span class="n">inference</span><span class="o">.</span><span class="n">build_posterior</span><span class="p">(</span><span class="n">density_estimator</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">posterior</span><span class="p">)</span> <span class="c1"># prints how the posterior was trained</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Posterior p(Î¸|x) of type DirectPosterior. It samples the posterior network and rejects samples that
            lie outside of the prior bounds.
</code></pre></div>

<h2 id="visualisations-of-the-inferred-posterior-for-a-new-observation">Visualisations of the inferred posterior for a new observation<a class="headerlink" href="#visualisations-of-the-inferred-posterior-for-a-new-observation" title="Permanent link">&para;</a></h2>
<p>Let&rsquo;s say we have made some observation <span class="arithmatex">\(x_{obs}\)</span> for which we now want to infer the posterior:</p>
<blockquote>
<p>Note: this is where your experimental observation would come in. For real observations, of course, you would not have access to the ground truth <span class="arithmatex">\(\theta\)</span>. </p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="n">theta_true</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span>
<span class="c1"># generate our observation</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">simulator</span><span class="p">(</span><span class="n">theta_true</span><span class="p">)</span>
</code></pre></div>
<p>Given this observation, we can sample from the posterior <span class="arithmatex">\(p(\theta|x_{obs})\)</span> and
visualise the posterior. Visualizing a three-dimensional distributions is challenging.
Therefore, we use <code>sbi</code>&rsquo;s <code>pairplot</code> function that generates a upper triangular grid of
plots, showing the univariate marginals on the diagnonal and every combination of
pairwise marginals for the three parameters on the upper offdiagonal:</p>
<div class="highlight"><pre><span></span><code><span class="n">samples</span> <span class="o">=</span> <span class="n">posterior</span><span class="o">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">10000</span><span class="p">,),</span> <span class="n">x</span><span class="o">=</span><span class="n">x_obs</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">pairplot</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span>
             <span class="n">limits</span><span class="o">=</span><span class="p">[[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
             <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
             <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s2">&quot;$\theta_1$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\theta_2$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\theta_3$&quot;</span><span class="p">])</span>
</code></pre></div>
<p><img alt="png" src="../00_getting_started_files/00_getting_started_25_0.png" /></p>
<h2 id="assessing-the-posterior-for-the-known-theta-x-pair">Assessing the posterior for the known (<span class="arithmatex">\(\theta, x\)</span>) - pair<a class="headerlink" href="#assessing-the-posterior-for-the-known-theta-x-pair" title="Permanent link">&para;</a></h2>
<p>For this special case, we have access to the ground-truth parameters that generated the
observation. We can thus assess if the inferred distributions over the parameters match
the parameters <span class="arithmatex">\(\theta_{true}\)</span> we used to generate our test observation <span class="arithmatex">\(x_{obs}\)</span>.</p>
<p>Note that in general, the inferred posterior distribution is not neccessarily centered
on the underlying &ldquo;ground-truth&rdquo; parameters <span class="arithmatex">\(\theta\)</span> because there is noise in simulator
and limited data. However, it should lie &ldquo;within&rdquo; the posterior.</p>
<div class="highlight"><pre><span></span><code><span class="n">samples</span> <span class="o">=</span> <span class="n">posterior</span><span class="o">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">10000</span><span class="p">,),</span> <span class="n">x</span><span class="o">=</span><span class="n">x_obs</span><span class="p">)</span>
<span class="n">pairplot</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span>
         <span class="n">points</span><span class="o">=</span><span class="n">theta_true</span><span class="p">,</span>
         <span class="n">limits</span><span class="o">=</span><span class="p">[[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
         <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s2">&quot;$\theta_1$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\theta_2$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\theta_3$&quot;</span><span class="p">]);</span>
</code></pre></div>
<p><img alt="png" src="../00_getting_started_files/00_getting_started_28_0.png" /></p>
<h2 id="assessing-the-predictive-performance-of-the-posterior">Assessing the predictive performance of the posterior<a class="headerlink" href="#assessing-the-predictive-performance-of-the-posterior" title="Permanent link">&para;</a></h2>
<p>Another way to assess the quality of the posterior is checking whether parameters
sampled from the posterior <span class="arithmatex">\(p(\theta \mid x_{obs})\)</span> can reproduce the observation
<span class="arithmatex">\(x_{obs}\)</span> when we simulate data with them. This <em>posterior predictive distribution</em>
should contain on the <span class="arithmatex">\(x_{obs}\)</span>. We can again use the <code>pairplot</code> function to
visualize it. </p>
<p>As you can see below, in this Gaussian toy example, the posterior predictive
distribution is nicely centered on the data it was conditioned on.</p>
<div class="highlight"><pre><span></span><code><span class="n">theta_posterior</span> <span class="o">=</span> <span class="n">posterior</span><span class="o">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">10000</span><span class="p">,),</span> <span class="n">x</span><span class="o">=</span><span class="n">x_obs</span><span class="p">)</span>  <span class="c1"># sample from posterior</span>
<span class="n">x_predictive</span> <span class="o">=</span> <span class="n">simulator</span><span class="p">(</span><span class="n">theta_posterior</span><span class="p">)</span>  <span class="c1"># simulate data from posterior</span>
<span class="n">pairplot</span><span class="p">(</span><span class="n">x_predictive</span><span class="p">,</span>
         <span class="n">points</span><span class="o">=</span><span class="n">x_obs</span><span class="p">,</span>  <span class="c1"># plot with x_obs as a point</span>
         <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
         <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s2">&quot;$x_1$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$x_2$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$x_3$&quot;</span><span class="p">]);</span>
</code></pre></div>
<p><img alt="png" src="../00_getting_started_files/00_getting_started_30_0.png" /></p>
<p>Finally, we can also compare the probabilities of different parameters under the
posterior. The log-probability should ideally indicate that the true parameters, given
the corresponding observation, are more likely than a different set of randomly chosen
parameters from the prior distribution. </p>
<p>Relative to the obtained log-probabilities, we can investigate the range of
log-probabilities of the parameters sampled from the posterior.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># first sample an alternative parameter set from the prior</span>
<span class="n">theta_diff</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">sample</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">log_probability_true_theta</span> <span class="o">=</span> <span class="n">posterior</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">theta_true</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_obs</span><span class="p">)</span>
<span class="n">log_probability_diff_theta</span> <span class="o">=</span> <span class="n">posterior</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">theta_diff</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_obs</span><span class="p">)</span>
<span class="n">log_probability_samples</span> <span class="o">=</span> <span class="n">posterior</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_obs</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;high for true theta :&#39;</span><span class="p">,</span> <span class="n">log_probability_true_theta</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;low for different theta :&#39;</span><span class="p">,</span> <span class="n">log_probability_diff_theta</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;range of posterior samples: min:&#39;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">log_probability_samples</span><span class="p">),</span><span class="s1">&#39; max :&#39;</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">log_probability_samples</span><span class="p">))</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>high for true theta : tensor([3.4911])
low for different theta : tensor([-351.0345])
range of posterior samples: min: tensor(-8.8757)  max : tensor(3.9791)
</code></pre></div>

<h2 id="next-steps">Next steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h2>
<p>To learn more about the capabilities of <code>sbi</code>, you can head over to the tutorial
<a href="../01_gaussian_amortized/">01_gaussian_amortized</a>, for inferring parameters for multiple
observations without retraining.</p>
<p>Alternatively, for an example with an <strong>actual</strong> simulator, you can read our example
for a scientific simulator from neuroscience under <a href="../Example_00_HodgkinHuxleyModel/">Example_00_HodgkinHuxleyModel</a>.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/sbi-dev/sbi" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>